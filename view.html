<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>نمایش سرور</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;600;700;800&display=swap" rel="stylesheet">
  
  <style>
    /* --- متغیرهای اصلی طراحی --- */
    :root {
      --font-family: "Vazirmatn", -apple-system, system-ui, Segoe UI, Roboto, sans-serif;
      --bg-gradient-start: #00c6ff;
      --bg-gradient-end: #0072ff;
      --card-bg: #ffffff;
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --accent-color: #0ea5e9; /* رنگ اصلی دکمه‌ها و لینک‌ها */
      --accent-hover: #0284c7;
      --danger-color: #ef4444;
      --danger-bg: rgba(239, 68, 68, 0.08);
      --code-bg: #f1f5f9;
      --code-border: #e2e8f0;
      --shadow-color: rgba(2, 6, 23, 0.12);
      --border-radius-lg: 16px;
      --border-radius-md: 10px;
    }

    /* --- استایل‌های پایه --- */
    html, body {
      height: 100%;
      margin: 0;
      font-family: var(--font-family);
      font-weight: 400;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(165deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      color: var(--text-primary);
      padding: 1rem;
    }

    /* --- کانتینر اصلی --- */
    .container {
      width: 100%;
      max-width: 700px; /* عرض بهینه برای خوانایی */
    }

    /* --- طراحی کارت اصلی --- */
    .card {
      background: var(--card-bg);
      border-radius: var(--border-radius-lg);
      box-shadow: 0 10px 35px var(--shadow-color), 0 2px 10px var(--shadow-color);
      padding: 2.5rem; /* 40px */
      text-align: center;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem; /* فاصله بین المان‌ها */
      animation: fadeIn 0.5s ease-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .title {
      font-size: 1.75rem; /* 28px */
      font-weight: 800;
      margin: 0;
      color: var(--text-primary);
    }

    .subtitle {
      color: var(--text-secondary);
      margin: 0;
      font-size: 1rem; /* 16px */
      line-height: 1.7;
      max-width: 500px; /* محدود کردن عرض برای خوانایی بهتر */
    }
    
    .btn {
      display: inline-block;
      margin-top: 1rem;
      background: var(--accent-color);
      color: white;
      padding: 0.8rem 1.5rem; /* 13px 24px */
      border-radius: var(--border-radius-md);
      text-decoration: none;
      font-weight: 700;
      transition: transform 0.2s ease, box-shadow 0.2s ease, background-color 0.2s ease;
      border: none;
      cursor: pointer;
    }

    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
      background: var(--accent-hover);
    }
    
    /* --- حالت خصوصی --- */
    .locked-icon {
      width: 80px;
      height: 80px;
      color: var(--accent-color);
    }

    /* --- انیمیشن لودینگ --- */
    .loader {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(0, 0, 0, 0.1);
      border-top-color: var(--accent-color);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* --- استایل نمایش JSON --- */
    .json-preview-wrapper {
        width: 100%;
        text-align: left;
    }
    .json-preview {
      direction: ltr;
      white-space: pre-wrap;
      word-break: break-all;
      background: var(--code-bg);
      padding: 1.25rem;
      border-radius: var(--border-radius-md);
      border: 1px solid var(--code-border);
      max-height: 450px;
      overflow-y: auto;
      color: var(--text-primary);
      font-family: monospace;
      font-size: 0.9rem;
    }
    
    /* --- نمایش خطا --- */
    .error-note {
      color: var(--danger-color);
      font-weight: 600;
      margin-top: 1rem;
      background: var(--danger-bg);
      padding: 0.8rem 1rem;
      border-radius: var(--border-radius-md);
      font-size: 0.9rem;
      font-family: monospace;
      width: 100%;
      box-sizing: border-box;
      word-break: break-word;
    }

    /* --- طراحی واکنش‌گرا --- */
    @media (max-width: 720px) {
      body { padding: 0.5rem; }
      .container { margin: 1rem; }
      .card { padding: 1.5rem; }
      .title { font-size: 1.5rem; /* 24px */ }
      .subtitle { font-size: 0.95rem; }
      .locked-icon { width: 60px; height: 60px; }
    }
  </style>
</head>
<body>

  <main class="container" id="contentArea">
    <!-- حالت اولیه: بارگذاری -->
    <div class="card" role="status" aria-live="polite">
      <div class="loader"></div>
      <h1 class="title">در حال بارگذاری...</h1>
      <p class="subtitle">لطفاً چند لحظه صبر کنید. در حال واکشی داده‌ها از سرور هستیم.</p>
    </div>
  </main>

  <!-- Firebase SDK نسخه 8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // --- پیکربندی Firebase ---
    const firebaseConfig = {
      apiKey: "AIzaSyAT8CDJoCOm8XVo62y-3CgS1Fqabdq2tjQ",
      authDomain: "serverjson-a2107.firebaseapp.com",
      databaseURL: "https://serverjson-a2107-default-rtdb.firebaseio.com",
      projectId: "serverjson-a2107",
      storageBucket: "serverjson-a2107.appspot.com",
      messagingSenderId: "1058313915119",
      appId: "1:1058313915119:web:4a967e4c8c401f1762a91a",
      measurementId: "G-T3Y95SVYPM"
    };
    
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const contentArea = document.getElementById('contentArea');

    // --- ابزارها ---
    const escapeHtml = (unsafe) => 
      unsafe
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');

    // --- توابع رندر کردن UI ---
    
    // UI جدید و بهبود یافته برای سرور خصوصی
    const renderPrivateUI = () => {
      contentArea.innerHTML = `
        <div class="card" role="alert">
          <svg class="locked-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 10.5V6.75a4.5 4.5 0 00-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 002.25-2.25v-6.75a2.25 2.25 0 00-2.25-2.25H4.5a2.25 2.25 0 00-2.25 2.25v6.75a2.25 2.25 0 002.25 2.25z" />
          </svg>
          <h1 class="title">دسترسی به این محتوا محدود است</h1>
          <p class="subtitle">
            این سرور توسط مالک آن به عنوان یک فضای خصوصی تنظیم شده است. محتوای خصوصی برای عموم قابل مشاهده نیست تا از اطلاعات حساس یا پروژه‌های در حال انجام محافظت شود.
          </p>
          <a class="btn" href="./Home page.html">بازگشت به صفحه اصلی</a>
        </div>
      `;
    };

    const renderNotFound = () => {
      contentArea.innerHTML = `
        <div class="card" role="alert">
          <h1 class="title">❌ سرور پیدا نشد</h1>
          <p class="subtitle">شناسه (ID) وارد شده معتبر نیست یا چنین سروری وجود ندارد. لطفاً آدرس را بررسی کنید.</p>
          <a class="btn" href="./Home page.html">بازگشت به داشبورد</a>
        </div>
      `;
    };

    const renderError = (errorMessage, details = '') => {
      contentArea.innerHTML = `
        <div class="card" role="alert">
          <h1 class="title">خطا در بارگذاری اطلاعات</h1>
          <p class="subtitle">${escapeHtml(errorMessage)}</p>
          ${details ? `<div class="error-note">${escapeHtml(details)}</div>` : ''}
        </div>
      `;
    };

    const renderHtmlContent = (html) => {
      // برای جایگزینی کامل صفحه، محتوا را مستقیماً می‌نویسیم
      document.open();
      document.write(html);
      document.close();
    };

    const renderJsonContent = (data) => {
      contentArea.innerHTML = `
        <div class="card">
          <div class="json-preview-wrapper">
            <h1 class="title" style="text-align: right; margin-bottom: 1rem;">نمایش محتوای JSON</h1>
            <pre class="json-preview">${escapeHtml(JSON.stringify(data, null, 2))}</pre>
          </div>
          <a class="btn" href="./Home page.html">بازگشت به داشبورد</a>
        </div>
      `;
    };

    // --- منطق اصلی اجرایی ---
    const main = async () => {
      const params = new URLSearchParams(window.location.search);
      const serverId = params.get('id');

      if (!serverId) {
        renderNotFound();
        return;
      }

      const TIMEOUT_DURATION = 12000; // ۱۲ ثانیه

      try {
        const fetchPromise = db.ref('servers/' + serverId).once('value');
        
        const timeoutPromise = new Promise((_, reject) => {
          setTimeout(() => reject(new Error('پاسخ از پایگاه داده بیش از حد طول کشید (Timeout).')), TIMEOUT_DURATION);
        });

        const snap = await Promise.race([fetchPromise, timeoutPromise]);
        const data = snap.val();

        if (!data) {
          // اگر داده وجود نداشته باشد یا null باشد، خصوصی تلقی می‌شود
          renderPrivateUI();
          return;
        }

        // بررسی نوع و وضعیت دسترسی برای محتوای HTML
        if (data.type?.toLowerCase() === 'html') {
          if (data.visibility?.toLowerCase() !== 'public') {
            renderPrivateUI();
          } else if (!data.content || String(data.content).trim() === '') {
            renderPrivateUI(); // محتوای خالی نیز خصوصی نمایش داده می‌شود
          } else {
            renderHtmlContent(data.content);
          }
        } else {
          // هر نوع داده دیگری به صورت JSON نمایش داده می‌شود
          renderJsonContent(data);
        }
      } catch (err) {
        console.error("خطا در واکشی از Firebase:", err);
        renderError('مشکلی در اتصال به پایگاه داده رخ داد.', err.message);
      }
    };

    // اجرای برنامه
    main();
  </script>
</body>
</html>
4
