<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ù…Ø§ÛŒØ´ Ø³Ø±ÙˆØ±</title>
  <style>
    :root{
      --bg1:#00c6ff;
      --bg2:#0072ff;
      --card:#ffffff;
      --muted:#64748b;
      --accent:#10b981;
    }
    html,body{height:100%;margin:0;font-family:"Vazirmatn",nt,system-ui,Segoe UI, Roboto, "Helvetica Neue", Arial;}
    body{
      display:flex;
      align-items:center;
      justify-content:center;
      background: linear-gradient(180deg,var(--bg1) 0%,var(--bg2) 100%);
      color:#0f172a;
    }

    /* container */
    .wrap{
      width:100%;
      max-width:980px;
      margin:40px;
    }

    /* private card */
    .card{
      background:var(--card);
      border-radius:14px;
      box-shadow:0 10px 30px rgba(2,6,23,0.18);
      overflow:hidden;
      display:flex;
      gap:0;
      min-height:220px;
      align-items:stretch;
    }

    .card-left{
      flex:1.1;
      padding:36px;
      display:flex;
      flex-direction:column;
      justify-content:center;
      gap:12px;
    }

    .card-right{
      flex:0.9;
      background:linear-gradient(180deg, rgba(0,0,0,0.02), rgba(0,0,0,0.04));
      padding:24px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .title{
      font-size:28px;
      font-weight:800;
      margin:0;
      color:#0b1220;
    }
    .subtitle{
      color:var(--muted);
      margin:0;
      font-size:15px;
      line-height:1.5;
    }

    .badge{
      display:inline-flex;
      gap:8px;
      margin-top:10px;
      align-items:center;
    }
    .pill{
      background:rgba(16,185,129,0.12);
      color:var(--accent);
      padding:8px 12px;
      border-radius:999px;
      font-weight:600;
      font-size:13px;
    }

    .lock{
      width:72px;
      height:72px;
      background:linear-gradient(135deg,#fef3c7,#fee2e2);
      border-radius:12px;
      display:grid;
      place-items:center;
      box-shadow:0 6px 18px rgba(2,6,23,0.12);
      font-size:34px;
    }

    .btn{
      display:inline-block;
      margin-top:18px;
      background:#0ea5a4;
      color:white;
      padding:10px 16px;
      border-radius:10px;
      text-decoration:none;
      font-weight:700;
    }

    /* fallback for small screens */
    @media (max-width:720px){
      .card{flex-direction:column}
      .card-right{order:-1;padding:18px;}
      .card-left{padding:20px;}
      .title{font-size:20px}
    }

    /* area where HTML content will be injected */
    #contentArea {
      width:100%;
      min-height:60vh;
      border-radius:12px;
      overflow:auto;
      box-shadow:0 8px 24px rgba(2,6,23,0.12);
      background:white;
    }

    /* small helper for error text */
    .error-note{color:#ef4444;font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <div id="contentArea">
      <!-- initial loading state -->
      <div style="padding:60px 40px;text-align:center;">
        <h2 style="margin:0;font-weight:800">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</h2>
        <p style="color:var(--muted);margin-top:8px">Ù„Ø·ÙØ§Ù‹ ØµØ¨Ø± Ú©Ù†ÛŒØ¯ â€” Ø¯Ø± Ø­Ø§Ù„ ÙˆØ§Ú©Ø´ÛŒ Ø¯Ø§Ø¯Ù‡ Ø§Ø² Ø³Ø±ÙˆØ±</p>
      </div>
    </div>
  </div>

  <!-- firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

  <script>
    // --- Ù¾ÛŒÚ©Ø±Ø¨Ù†Ø¯ÛŒ ÙØ§ÛŒØ±Ø¨ÛŒØ³ (Ù…Ù‚Ø§Ø¯ÛŒØ± Ù¾Ø±ÙˆÚ˜Ù‡Ù” Ø®ÙˆØ¯Øª) ---
    const firebaseConfig = {
      apiKey: "AIzaSyAT8CDJoCOm8XVo62y-3CgS1Fqabdq2tjQ",
      authDomain: "serverjson-a2107.firebaseapp.com",
      projectId: "serverjson-a2107",
      databaseURL: "https://serverjson-a2107-default-rtdb.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // --- Ø®ÙˆØ§Ù†Ø¯Ù† id Ø§Ø² Ù¾Ø§Ø±Ø§Ù…ØªØ± URL ---
    const params = new URLSearchParams(window.location.search);
    const serverId = params.get('id');

    const contentArea = document.getElementById('contentArea');

    function renderPrivateUI(reason) {
      // Ø·Ø±Ø§Ø­ÛŒ ØµÙØ­Ù‡Ù” Ú¯Ø±Ø§ÙÛŒÚ©ÛŒÙ "Ø®ØµÙˆØµÛŒ Ø§Ø³Øª"
      contentArea.innerHTML = `
        <div class="card" role="note">
          <div class="card-left">
            <h1 class="title">ğŸ”’ Ø§ÛŒÙ† Ø³Ø±ÙˆØ± Ø®ØµÙˆØµÛŒ Ø§Ø³Øª</h1>
            <p class="subtitle">Ù…Ø§Ù„Ú© Ø§ÛŒÙ† Ø³Ø±ÙˆØ± Ø¢Ù† Ø±Ø§ Ø§Ø² Ø­Ø§Ù„Øª Ø¹Ù…ÙˆÙ…ÛŒ Ø®Ø§Ø±Ø¬ Ú©Ø±Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§Ù‡Ø¯Ù‡Ù” Ù…Ø­ØªÙˆØ§ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ø±Ø¯ Ø­Ø³Ø§Ø¨ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø´Ø¯Ù‡ Ùˆ Ø¯Ø³ØªØ±Ø³ÛŒ Ù„Ø§Ø²Ù… Ø±Ø§ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´ÛŒØ¯.</p>
            <div class="badge">
              <div class="pill">Ø­Ø±ÛŒÙ… Ø®ØµÙˆØµÛŒ</div>
              <div style="flex:1"></div>
              <a class="btn" href="./Login.html">ÙˆØ±ÙˆØ¯ / Ø¯Ø³ØªØ±Ø³ÛŒ</a>
            </div>
            ${ reason ? `<p style="margin-top:12px;color:var(--muted);font-size:13px">Ø¬Ø²Ø¦ÛŒØ§Øª: ${reason}</p>` : '' }
          </div>
          <div class="card-right">
            <div class="lock">ğŸ”</div>
          </div>
        </div>
      `;
    }

    function renderNotFound() {
      contentArea.innerHTML = `
        <div style="padding:60px;text-align:center;">
          <h2 class="title">âŒ Ø³Ø±ÙˆØ± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯</h2>
          <p class="subtitle">Ú†Ù†ÛŒÙ† Ø³Ø±ÙˆØ±ÛŒ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯ ÛŒØ§ Ø¢ÛŒØ¯ÛŒ Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª.</p>
          <p style="margin-top:24px"><a class="btn" href="./Home page.html">Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯</a></p>
        </div>
      `;
    }

    function renderHtmlContent(html) {
      // Ø§ÛŒÙ† Ø­Ø§Ù„Øª Ù…Ø­ØªÙˆØ§ÛŒ HTML Ø§ØµÙ„ Ø±Ø§ Ø±Ù†Ø¯Ø± Ù…ÛŒâ€ŒÚ©Ù†Ø¯.
      // Ù‡Ø´Ø¯Ø§Ø± Ø§Ù…Ù†ÛŒØªÛŒ: Ø§ÛŒÙ† Ø®Ø· Ø¨Ø§Ø¹Ø« Ø§Ø¬Ø±Ø§ÛŒ ØªÚ¯ <script> Ø¯Ø±ÙˆÙ† html Ù…ÛŒâ€ŒØ´ÙˆØ¯.
      // Ø§Ú¯Ø± Ù†Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯Ù‡ Ø§Ø¬Ø±Ø§ Ø´ÙˆÙ†Ø¯ØŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡Ù” Ø§Ù…Ù† Ø²ÛŒØ± Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†:
      // contentArea.innerHTML = '<div style="padding:20px">' + escapeHtml(html) + '</div>';
      document.open();
      document.write(html);
      document.close();
    }

    // Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø² Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ù…Ø­ØªÙˆØ§ Ø±Ø§ Ø§ÛŒÙ…Ù†â€ŒØªØ± Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯ (Ø¨Ø¯ÙˆÙ† Ø§Ø¬Ø±Ø§ÛŒ Ø§Ø³Ú©Ø±ÛŒÙ¾Øª)
    function escapeHtml(unsafe) {
      return unsafe
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#039;');
    }

    // --- Ø§Ø¬Ø±Ø§ÛŒÛŒ ---
    if (!serverId) {
      renderNotFound();
    } else {
      db.ref('servers/' + serverId).once('value').then(snap => {
        const data = snap.val();

        // Ø§Ú¯Ø± Ù‡ÛŒÚ† Ø¯Ø§Ø¯Ù‡â€ŒØ§ÛŒ Ù†Ø¨Ø§Ø´Ù‡ -> Ù…Ù…Ú©Ù†Ù‡ Ø­Ø°Ù Ø´Ø¯Ù‡ ÛŒØ§ Ø®ØµÙˆØµÛŒÙ‡
        if (!data) {
          renderPrivateUI('Ù…ÙˆØ±Ø¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø§ÛŒÙ† Ø¢ÛŒØ¯ÛŒ Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†ÛŒØ³Øª (null).');
          return;
        }

        // Ø§Ú¯Ø± Ù†ÙˆØ¹ json Ø¨Ø§Ø´Ù‡ Ùˆ ÙÙ‚Ø· Ø¨Ø®ÙˆØ§ÛŒ JSON Ù†Ù…Ø§ÛŒØ´ Ø¨Ø¯ÛŒØŒ Ù…ÛŒâ€ŒØªÙˆÙ†ÛŒ Ø§ÛŒÙ†Ø¬Ø§ Ø±ÙØªØ§Ø± Ù…ØªÙØ§ÙˆØª Ø¨Ø°Ø§Ø±ÛŒ.
        if (data.type && data.type.toLowerCase() === 'html') {
          // Ø§Ú¯Ø± ÙÛŒÙ„Ø¯ visibility ÙˆØ¬ÙˆØ¯ Ø¯Ø§Ø±Ù‡ Ùˆ Ø¹Ù…ÙˆÙ…ÛŒ Ù†ÛŒØ³Øª -> ØµÙØ­Ù‡Ù” Ø®ØµÙˆØµÛŒ Ù†Ø´ÙˆÙ† Ø¨Ø¯Ù‡
          if (data.visibility && data.visibility.toLowerCase() !== 'public') {
            renderPrivateUI('Ù…Ø§Ù„Ú© Ø³Ø±ÙˆØ± Ø¢Ù† Ø±Ø§ Ø¨Ù‡ Ø­Ø§Ù„Øª Ø®ØµÙˆØµÛŒ ØªØºÛŒÛŒØ± Ø¯Ø§Ø¯Ù‡ Ø§Ø³Øª.');
            return;
          }

          // Ø§Ú¯Ø± content ØªÙ‡ÛŒ ÛŒØ§ null ÛŒØ§ Ø±Ø´ØªÙ‡Ù” Ø®Ø§Ù„ÛŒ Ø¨ÙˆØ¯ -> Ø®ØµÙˆØµÛŒ ÛŒØ§ Ù†Ø§Ù„
          if (!data.content || data.content === null || (typeof data.content === 'string' && data.content.trim() === '')) {
            renderPrivateUI('Ù…Ø­ØªÙˆØ§ Ø®Ø§Ù„ÛŒ Ø§Ø³Øª ÛŒØ§ Ø­Ø°Ù Ø´Ø¯Ù‡ Ø§Ø³Øª.');
            return;
          }

          // Ø¯Ø± ØºÛŒØ± Ø§ÛŒÙ† ØµÙˆØ±Øª: Ø±Ù†Ø¯Ø± Ù…Ø­ØªÙˆØ§ÛŒ HTML
          renderHtmlContent(data.content);
          return;
        }

        // Ø§Ú¯Ø± Ù†ÙˆØ¹ ØºÛŒØ± htmlÙ‡: Ù¾ÛŒØ§Ù… Ù…Ù†Ø§Ø³Ø¨ (Ù…Ø«Ù„Ø§Ù‹ JSON)
        contentArea.innerHTML = `
          <div style="padding:40px;text-align:center;">
            <h2 class="title">Ù†Ù…Ø§ÛŒØ´ JSON Ø³Ø±ÙˆØ±</h2>
            <pre style="text-align:left;white-space:pre-wrap;background:#0b122033;padding:18px;border-radius:8px;">${escapeHtml(JSON.stringify(data, null, 2))}</pre>
            <p style="margin-top:18px"><a class="btn" href="./Home page.html">Ø¨Ø§Ø²Ú¯Ø´Øª</a></p>
          </div>
        `;
      }).catch(err => {
        console.error(err);
        contentArea.innerHTML = `
          <div style="padding:40px;text-align:center;">
            <h2 class="title">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</h2>
            <p class="subtitle">Ø¯Ø± Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯ÛŒØªØ§Ø¨ÛŒØ³ Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯.</p>
            <p style="margin-top:12px;color:#ef4444">${escapeHtml(err.message || '')}</p>
          </div>
        `;
      });
    }
  </script>
</body>
</html>
